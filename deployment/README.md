# Claude Code UI Deployment Guide

This guide provides instructions for deploying Claude Code UI as a production service on Linux/WSL systems.

## Overview

Claude Code UI can be deployed in multiple ways:
- **Native Linux Service** - Using systemd for process management
- **Docker Container** - Containerized deployment with Docker
- **Manual Installation** - Direct installation without service management

## Prerequisites

- Node.js 18+ installed
- Linux or WSL environment
- Root/sudo access (for service installation)
- Git (for cloning the repository)

## Quick Start

### 1. Build the Package

```bash
# Clone the repository
git clone https://github.com/yourusername/claudecodeui.git
cd claudecodeui

# Install dependencies
npm install

# Build the deployment package
npm run package
```

This creates a distributable package in `build/claudecodeui-{version}-linux-x64.tar.gz`

### 2. Install as System Service

```bash
# Extract the package
tar -xzf claudecodeui-1.5.0-linux-x64.tar.gz
cd claudecodeui-1.5.0-linux-x64

# Run the installer (requires root)
sudo ./deployment/scripts/install.sh
```

### 3. Access the Application

Once installed, the service will be available at:
- Web UI: `http://localhost:3002`
- Health Check: `http://localhost:3002/api/health`

## Deployment Methods

### Method 1: Systemd Service (Recommended)

#### Installation

The installer script performs the following actions:

1. Creates a dedicated system user (`claudecodeui`)
2. Installs application files to `/opt/claudecodeui`
3. Sets up configuration in `/etc/claudecodeui/`
4. Creates systemd service unit
5. Enables and starts the service

#### Service Management

```bash
# Start the service
sudo systemctl start claudecodeui

# Stop the service
sudo systemctl stop claudecodeui

# Restart the service
sudo systemctl restart claudecodeui

# Check service status
sudo systemctl status claudecodeui

# View logs
sudo journalctl -u claudecodeui -f

# Disable auto-start
sudo systemctl disable claudecodeui
```

#### Configuration

Configuration file location: `/etc/claudecodeui/claudecodeui.conf`

```bash
# Claude Code UI Configuration
PORT=3002
NODE_ENV=production
JWT_SECRET=<auto-generated>
DATABASE_PATH=/opt/claudecodeui/database/claudecodeui.db
LOG_LEVEL=info
```

#### Uninstallation

```bash
sudo /opt/claudecodeui/deployment/scripts/uninstall.sh
```

The uninstaller will:
- Stop and disable the service
- Create a backup of configuration and database
- Remove application files
- Optionally remove logs and service user

### Method 2: Docker Deployment

#### Build Docker Image

```bash
# Build the production image
npm run package:docker

# Or manually
docker build -f deployment/Dockerfile.production -t claudecodeui:latest .
```

#### Run with Docker Compose

```bash
# Start the service
npm run package:compose

# Or manually
docker-compose -f deployment/docker-compose.production.yml up -d

# View logs
docker-compose -f deployment/docker-compose.production.yml logs -f

# Stop the service
docker-compose -f deployment/docker-compose.production.yml down
```

#### Docker Environment Variables

Create a `.env` file for Docker deployment:

```env
JWT_SECRET=your-secret-key
PORT=3002
NODE_ENV=production
```

### Method 3: Manual Installation

For development or custom deployments:

```bash
# Build the application
npm run build

# Set environment variables
export PORT=3002
export NODE_ENV=production
export JWT_SECRET=$(openssl rand -base64 32)

# Start the server
node server/index.js
```

## Security Considerations

### 1. User Permissions

The service runs as a non-root user (`claudecodeui`) with limited permissions:
- Read-only access to application files
- Write access only to database and log directories
- No shell access (`/bin/false`)

### 2. File System Protection

The systemd service includes security hardening:
- `ProtectSystem=strict` - Read-only file system
- `ProtectHome=true` - No access to user home directories
- `PrivateTmp=true` - Isolated temporary directory
- `NoNewPrivileges=true` - Prevent privilege escalation

### 3. Network Security

- Default binding to localhost only
- JWT authentication for API access
- Optional API key validation
- HTTPS support via reverse proxy

### 4. Sensitive Data

- JWT secret auto-generated during installation
- Database stored with restricted permissions
- Configuration files protected (mode 600)

## Production Recommendations

### 1. Reverse Proxy Setup

Use Nginx or Apache as a reverse proxy:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 2. SSL/TLS Configuration

Always use HTTPS in production:
- Use Let's Encrypt for free SSL certificates
- Configure in reverse proxy, not application

### 3. Backup Strategy

Regular backups should include:
- `/etc/claudecodeui/claudecodeui.conf` - Configuration
- `/opt/claudecodeui/database/` - Application database
- `/var/log/claudecodeui/` - Logs (optional)

### 4. Monitoring

Monitor service health:
- Use the `/api/health` endpoint
- Set up alerts for service failures
- Monitor disk space for logs and database

### 5. Resource Limits

Consider setting resource limits in systemd:

```ini
# Add to claudecodeui.service
[Service]
MemoryLimit=1G
CPUQuota=80%
```

## Troubleshooting

### Service Won't Start

1. Check logs: `sudo journalctl -u claudecodeui -n 50`
2. Verify permissions: `ls -la /opt/claudecodeui`
3. Check port availability: `sudo lsof -i :3002`

### Permission Errors

```bash
# Fix ownership
sudo chown -R claudecodeui:claudecodeui /opt/claudecodeui
sudo chown -R claudecodeui:claudecodeui /var/log/claudecodeui
```

### Database Issues

```bash
# Backup database
sudo cp /opt/claudecodeui/database/claudecodeui.db /tmp/backup.db

# Reset database (loses all data!)
sudo rm /opt/claudecodeui/database/claudecodeui.db
sudo systemctl restart claudecodeui
```

### Port Conflicts

Edit `/etc/claudecodeui/claudecodeui.conf` and change the PORT value, then restart the service.

## Support

For issues or questions:
- Check the [GitHub Issues](https://github.com/yourusername/claudecodeui/issues)
- Review application logs
- Ensure all prerequisites are met

## License

This deployment package is part of Claude Code UI, licensed under the MIT License.